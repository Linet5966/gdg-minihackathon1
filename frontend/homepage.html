<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wellness Tracker - Home</title>
    <link rel="stylesheet" href="homepage.css" />
  </head>
  <body>
    <nav id="sidebar">
      <div class="sidebar-header">
        <h2>Wellness</h2>
        <button id="sidebar-toggle">‚ò∞</button>
      </div>
      <ul>
        <li><a href="homepage.html">Home</a></li>
        <li><a href="Goalspage.html">Goals</a></li>
        <li><a href="GoalsTracker.html">Tracker</a></li>
        <li><a href="games.html">Games</a></li>
        <li id="login-nav"><a href="login.html">Login</a></li>
        <li id="signup-nav"><a href="signup.html" class="primary-btn">Sign Up</a></li>
        <li id="logout-nav" style="display: none;"><a href="#" id="logout-link" class="back-btn">Logout</a></li>
      </ul>
    </nav>
    <div id="main-content">
      <header>
        <div class="header-left">
          <button id="sidebar-toggle-desktop">‚ò∞</button>
          <button id="sidebar-toggle-mobile">‚ò∞</button>
        </div>
        <h1>Emotional Support Chatbot</h1>
        <div id="mood-selector">
          <label>Your Mood:</label>
          <div class="mood-options">
            <button class="mood-btn" data-mood="happy">üòä</button>
            <button class="mood-btn" data-mood="sad">üò¢</button>
            <button class="mood-btn" data-mood="angry">üò†</button>
            <button class="mood-btn" data-mood="anxious">üò∞</button>
            <button class="mood-btn" data-mood="neutral">üòê</button>
          </div>
        </div>
        <button
          id="api-toggle-btn"
          class="api-toggle-btn"
          title="API Key Settings"
        >
          ‚öôÔ∏è
        </button>
      </header>
      <main>
        <section id="chatbot">
          <div id="chat-window">
            <div id="chat-messages"></div>
            <div class="chat-input-area">
              <input
                type="text"
                id="chat-input"
                placeholder="Share your thoughts..."
              />
              <button id="send-chat">Send</button>
            </div>
          </div>
        </section>
        <section id="api-key-section" class="collapsed">
          <div class="api-key-header">
            <h3>API Key Setup</h3>
            <button class="api-close-btn" title="Collapse">‚àí</button>
          </div>
          <div class="api-key-content">
            <p>
              To enable advanced AI emotional support, enter your OpenAI API
              key:
            </p>
            <input type="password" id="api-key-input" placeholder="sk-..." />
            <button id="save-api-key">Save Key</button>
            <p>
              <small
                >Note: This is stored locally in your browser for this session
                only.</small
              >
            </p>
            <div class="api-links">
              <p><strong>Don't have an API key?</strong></p>
              <ul>
                <li>
                  <a
                    href="https://platform.openai.com/account/api-keys"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    Get OpenAI API Key ‚Üí
                  </a>
                </li>
                <li>
                  <a
                    href="https://console.anthropic.com/account/keys"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    Get Anthropic API Key ‚Üí
                  </a>
                </li>
                <li>
                  <a
                    href="https://ai.google.dev/tutorials/setup"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    Get Google Gemini API Key ‚Üí
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </section>
      </main>
    </div>
    <script>
      // Check authentication before allowing access to homepage
      function checkAuth() {
        const loggedInUser = localStorage.getItem('loggedInUser');
        if (!loggedInUser) {
          // User not authenticated, redirect to login
          window.location.href = 'login.html';
          return false;
        }
        return true;
      }

      // Update navigation based on auth state
      function updateNavigation() {
        const loggedInUser = localStorage.getItem('loggedInUser');
        const loginNav = document.getElementById('login-nav');
        const signupNav = document.getElementById('signup-nav');
        const logoutNav = document.getElementById('logout-nav');
        const logoutLink = document.getElementById('logout-link');

        if (loggedInUser) {
          // User is logged in - show logout, hide login/signup
          if (loginNav) loginNav.style.display = 'none';
          if (signupNav) signupNav.style.display = 'none';
          if (logoutNav) logoutNav.style.display = 'block';

          // Setup logout functionality
          if (logoutLink) {
            logoutLink.addEventListener('click', (e) => {
              e.preventDefault();
              localStorage.removeItem('loggedInUser');
              window.location.href = '../index.html';
            });
          }
        } else {
          // User not logged in - show login/signup, hide logout
          if (loginNav) loginNav.style.display = 'block';
          if (signupNav) signupNav.style.display = 'block';
          if (logoutNav) logoutNav.style.display = 'none';
        }
      }

      // Check authentication on page load
      if (!checkAuth()) {
        // Exit early if not authenticated
        throw new Error('Authentication required');
      }

      // Update navigation after auth check
      updateNavigation();
    </script>
    <script src="homepage.js"></script>
  </body>
</html>
